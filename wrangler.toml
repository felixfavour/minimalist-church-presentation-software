# Wrangler configuration for Cloud of Worship
# Cloudflare Workers deployment configuration

name = "cloud-of-worship"
main = ".output/server/index.mjs"
compatibility_date = "2024-01-10"
compatibility_flags = ["nodejs_compat"]

# Account and workers settings
workers_dev = true
account_id = "" # Add your Cloudflare account ID here

# Node.js compatibility
node_compat = true

[build]
command = "npm update -g npm && nvm use && npm run build"

# Environment variables for production
[env.production]
name = "cloud-of-worship-production"
route = "cloudofworship.com/*"

[env.production.vars]
NODE_ENV = "production"
BASE_URL = "https://api.cloudofworship.com/api/v1"
ASSETS_BASE_URL = "https://worshipcloud.favourfelix.com"
CLOUD_AWS_BUCKET_NAME = "presentation-software"
CLOUD_AWS_BUCKET_REGION = "eu-west-3"

# Environment variables for staging
[env.staging]
name = "cloud-of-worship-staging"
route = "staging.cloudofworship.com/*"

[env.staging.vars]
NODE_ENV = "development"
BASE_URL = "https://api.cloudofworship.com/api/v1"
ASSETS_BASE_URL = "https://worshipcloud.favourfelix.com"
CLOUD_AWS_BUCKET_NAME = "presentation-software"
CLOUD_AWS_BUCKET_REGION = "eu-west-3"

# Asset configuration
[site]
bucket = ".output/public"

# Observability
[observability]
enabled = true

# Limits
[limits]
cpu_ms = 50
